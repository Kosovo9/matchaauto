name = "match-auto-backend"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

[vars]
NODE_ENV = "production"
VERSION = "2.0.0"
SOLANA_RPC_URL = "https://api.mainnet-beta.solana.com"
SOLANA_NETWORK = "mainnet-beta"
CLERK_SECRET_KEY = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
CLERK_PUBLISHABLE_KEY = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
AI_TOXICITY_THRESHOLD = "0.8"
DAILY_BUDGET = "10.00"
SUPABASE_URL = "https://your-project.supabase.co"
SUPABASE_KEY = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

[[kv_namespaces]]
binding = "CRYPTO_CACHE"
id = "f9d059c074894e5aad6b2c859340a451"

[[kv_namespaces]]
binding = "SENTINEL_KV"
id = "f1900b827c334b159d60ca69519e1c27"

[[kv_namespaces]]
binding = "ADMIN_LOGS"
id = "9312c858dbc64c0b8f1b9922143509bd"

[[kv_namespaces]]
binding = "ANALYTICS"
id = "aa10eab1e60f42059195563561a09cb0"

[[kv_namespaces]]
binding = "COSTS"
id = "9486e7a95b5f4a20a5d2dba16faa0337"

[[kv_namespaces]]
binding = "GOLDEN_METRICS"
id = "c50ded2d6e7a4837b97c31d801f8a5b7"

[[kv_namespaces]]
binding = "VIRAL_DATA"
id = "e86c8cdf88b343cda68b3c8db3937618"

[[d1_databases]]
binding = "DB"
database_name = "match-auto-db"
database_id = "1421fd13-367a-4303-bafc-f7e65ac147ac"

[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "match-auto-media"

[durable_objects]
bindings = [
  { name = "RATE_LIMIT_STORE", class_name = "RateLimitStore" },
  { name = "CHAT_ROOM", class_name = "ChatRoom" },
  { name = "BID_STREAM", class_name = "BidStreamDO" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["RateLimitStore", "ChatRoom"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["BidStreamDO"]

[triggers]
crons = [
  "*/5 * * * *",        # Cada 5 minutos: cost tracker
  "*/15 * * * *",       # Cada 15 minutos: golden metrics
  "0 * * * *",          # Cada hora: limpieza de logs
]
